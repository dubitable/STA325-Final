---
title: "svm"
output: pdf_document
---

```{r}
set.seed(123)

library(e1071)
library(caret)

source("cleandata.R")
source("partition.R")
source("confusionmatrix.R")
```

```{r}
diabetes_raw <- read.csv("data/diabetes_012_health_indicators_BRFSS2015.csv")
diabetes <- cleandata(diabetes_raw)
head(diabetes)
```

```{r}
diabetes |> count(Diabetes_012)
```

```{r}
split <- partition(diabetes, 0.8)
train <- split$train
test <- split$test

train |> count(Diabetes_012)
```

```{r}
svm.model <- svm(
  Diabetes_012 ~ .,
  data = train,
  kernel = "radial",
  cost = 100,
  gamma = 0.001
)
```

```{r}
#tune.out <- e1071::tune(
#  svm,
#  Diabetes_012 ~ .,
#  data = train,
#  kernel = "radial",
#  ranges = list(
#    cost = c(0.1, 1, 10, 100),
#    gamma = c(0.001, 0.01, 0.1, 1)
#  )
#)
```

```{r}
summary(svm.model)
```
```{r}
pred <- predict(svm.model, newdata = test)
cm <- confusionMatrix(pred, test$Diabetes_012) 
plot_cm(cm)
```



